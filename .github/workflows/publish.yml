name: Publish Package

on:
  push:
    tags:
      - 'v*.*.*'

jobs:
  publish:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.3'
          extensions: mbstring, xml, ctype, iconv, intl, pdo_sqlite, dom, filter, gd, json, pdo

      - name: Install dependencies
        run: composer install --no-dev --no-interaction --prefer-dist --optimize-autoloader

      - name: Validate composer.json
        run: composer validate --no-check-all

      - name: Publish to Packagist
        if: ${{ secrets.PACKAGIST_TOKEN != '' && secrets.PACKAGIST_USERNAME != '' }}
        run: |
          echo "Publishing to Packagist..."
          curl -XPOST -H 'Authorization: Bearer ${{ secrets.PACKAGIST_TOKEN }}' \
          "https://packagist.org/api/update-package?username=${{ secrets.PACKAGIST_USERNAME }}&apiToken=${{ secrets.PACKAGIST_TOKEN }}" \
          -d "repository=https://github.com/${{ github.repository }}"

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          name: Release ${{ github.ref_name }}
          body: |
            ## What's Changed in ${{ github.ref_name }}
            
            ### âœ¨ Features
            - Automatic Filament resource scanning and localization
            - Structured translation file organization following Filament conventions
            - Git integration with automatic commits for easy rollback
            - Detailed processing statistics and progress tracking
            - Selective panel processing (specific panels or all at once)
            - Safe operation with automatic backups before modification
            - Multi-locale support for international applications
            - Dry run mode for previewing changes without applying them
            
            ### ðŸŽ¯ Supported Components
            - **Form Components**: TextInput, Select, DatePicker, FileUpload, RichEditor, etc.
            - **Table Columns**: TextColumn, IconColumn, ImageColumn, ColorColumn, etc.
            - **Infolist Entries**: TextEntry, IconEntry, ImageEntry, etc.
            - **Layout Components**: Section, Tabs, Grid, Fieldset, etc.
            - **Actions & Filters**: All action types and table filters
            
            ### ðŸ“‹ Requirements
            - PHP ^8.2|^8.3|^8.4
            - Laravel ^12.0
            - Filament ^4.0
            
            ## ðŸš€ Installation
            ```bash
            composer require mominalzaraa/filament-localization
            ```
            
            ## âš¡ Quick Start
            ```bash
            # Localize all panels
            php artisan filament:localize
            
            # Localize specific panel
            php artisan filament:localize --panel=admin
            
            # Dry run to preview changes
            php artisan filament:localize --dry-run
            ```
            
            ðŸ“– **Full Documentation**: [README.md](https://github.com/MominAlZaraa/filament-localization#readme)
          draft: false
          prerelease: false
          files: |
            composer.json
            README.md
            LICENSE
